<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SHADOW</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- JQUERY JS -->
    <script src="/webjars/jquery/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css?family=Lato:400,700');
        @import url("https://fonts.googleapis.com/earlyaccess/notosanskr.css");
        a {
            color: black;
            text-decoration: none;
        }

        /*ì±—ë´‡ offìƒíƒœ ë§í’ì„ */
        .ch-button{
            position: fixed;
            width: 84px;
            height: 84px;
            bottom: 40px;
            right: 40px;
            border: 0;
            outline: 0;
            color: #79C7C5;
            background-color: transparent;
         }

        /*ì±—ë´‡ onìƒíƒœ ì±„íŒ…ì°½*/
        .chat_container {
            display: none;
            position: fixed;
            width : 23%;
            height : 58%;
            bottom : 0;
            right : 0;
            margin : 0 10px 20px 0;
            /*background: linear-gradient(to bottom left,  #79C7C5 40%, #F9FBFF 100%);*/
            border-radius: 15px 15px 0px 15px;
            /*border : 1px solid #79C7C5;*/
            background-color: rgb(236, 240, 243);
            box-shadow: 0px 0px 0.4rem 0.1rem rgba(0,0,0,0.1);
            font-family: "Noto Sans KR", sans-serif;
        }

        .chatbox {
            width:100%;
            height:100%;
            background-color: rgb(236, 240, 243);
            border-radius: 15px 15px 0px 15px;
        }

        /*ì±—ë´‡ ìƒë‹¨*/
        .top-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 9%;
            /*background:#F9FBFF;*/
            background-color: rgb(236, 240, 243);
            border-radius: 10px 10px 0 0;
            gap : 8px;
            /*margin:1px;*/
        }

        .icon-image{
            display : flex;
            justify-content: center;
            align-items: center;
            width: 130px;
            height: 35px;
            margin-left: 3%;
        }

        .avatar {
            display : flex;
            justify-content: center;
            align-items: center;
            width: 35px;
            height: 35px;
            margin-left: 3%;
            background: linear-gradient(to bottom left, #79C7C5 20%, #A1E2D9 100%);
            border-radius: 50%;
            color: #79C7C5;
        }

        .name {
            text-transform: uppercase;
            color: #777777;
            font-size: 1em;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .gap{
            flex-grow : 1;
        }

        .btn-close{
            border: 0;
            font-size: 1em;
            color:#A1E2D9;
            margin-right: 3%;
            opacity: 0.8;
            cursor: pointer;
        }

        /*ì±—ë´‡ ì¤‘ë‹¨*/
        .middle {
            display : flex;
            flex-direction: column;
            padding: 10px;
            background: white;
            width: 100%;
            opacity: 0.85;
            top: 60px;
            height: 75%;
            overflow-y: auto;
            border-radius: 15px 0px 0px 0px;
        }
        /*ìŠ¤í¬ë¡¤ë°” */
        .middle::-webkit-scrollbar {
            width: 10px;  /* ìŠ¤í¬ë¡¤ë°”ì˜ ë„ˆë¹„ */
        }

        .middle::-webkit-scrollbar-thumb {
            height: 30%; /* ìŠ¤í¬ë¡¤ë°”ì˜ ê¸¸ì´ */
            background: #58CCFF; /* ìŠ¤í¬ë¡¤ë°”ì˜ ìƒ‰ìƒ */
            border-radius: 10px;
        }

        .middle::-webkit-scrollbar-track {
            background: rgba(33, 122, 244, .1);  /*ìŠ¤í¬ë¡¤ë°” ë’· ë°°ê²½ ìƒ‰ìƒ*/
        }

        /*ë§í’ì„  ì‚¬ìš©ì ì±„íŒ…*/
        .incoming
        {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            position: relative;
            width: fit-content;
            margin : 1% auto 1% 5%;
            padding:10px;
            background: #58CCFF;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
        }
        .incoming:after
        {
            content: '';
            position: absolute;
            border-style: solid;
            border-width: 6px 10px 6px 0;
            border-color: transparent #58CCFF;
            display: block;
            width: 0;
            z-index: 1;
            left: -10px;
            top: 12px;
        }

        .outgoing-box{
            display: flex;
        }

        .outgoing
        {
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
            position: relative;
            width: fit-content;
            padding: 10px;
            margin : 1% 3% 1% auto;
            background: rgb(236, 240, 243);
            border-radius: 15px;
        }

        .outgoing:after
        {
            content: '';
            position: absolute;
            border-style: solid;
            border-width: 6px 0 6px 10px;
            border-color: transparent rgb(236, 240, 243);
            display: block;
            width: 0;
            z-index: 1;
            right: -7px;
            top: 10px;
        }

        /*ì±—ë´‡ ìì£¼ì°¾ëŠ” ëª©ë¡*/
        .favorite{
            border:2px solid #58CCFF;
            color: #58CCFF;
            font-weight: 400;
            border-radius: 15px;
        }

        .favorite:hover{
            background: #58CCFF;
            color: white;
        }

        /*ì±—ë´‡ í•˜ë‹¨*/
        .bottom-bar {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 16%;
            background-color: white;
        }

        .send-form{
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .form-box{
            display: flex;
            align-items: center;
            justify-content: center;
            background:rgb(236, 240, 243);
            border-radius: 10px;
            padding: 5px 20px 5px 20px;
            width: 90%;
        }

        .input-msg {
            width: 80%;
            border: 0;
            background:rgb(236, 240, 243);
            color: rgb(236, 240, 243);
            font-size: 15px;
        }

        .input-msg::placeholder {
            color:#A1E2D9;
            font-size: 13px;
        }

        .input-msg:focus {
            color: #777777;
            outline: 0;
        }

        #send{
            color:#A1E2D9;
            opacity: 0.8;
            cursor: pointer;
            border: 0;
            background-color: transparent;
        }

        @keyframes bounce {
            30% { transform: translateY(-2px); }
            60% { transform: translateY(0px); }
            80% { transform: translateY(2px); }
            100% { transform: translateY(0px); opacity: 0.5;  }
        }
</style>

    <script th:inline="javascript">

        //ì±—ë´‡ ì¼œê¸°
        function OpenChat(){
            $("#container").show();
            $("#btnChatOpen").hide();
            console.log("ê·¸ëŸ¼ ì—¬ê¸° ë˜ëƒ?");
        }

        //ì±—ë´‡ ë‹«ê¸°
        function CloseChat(){
            $("#container").hide();
            $("#btnChatOpen").show();
        }

        function ChatMessageWrite(event, form){

            event.preventDefault();

            console.log(form.message.value);

            form.message.value = form.message.value.trim();

            if ( form.message.value.length == 0 ) {
                form.message.focus();
                return false;
            }

            $("#greetings").append("<div class=\"incoming\">" + form.message.value + "</div>");  //html ì¶”ê°€
            $('#greetings').scrollTop($('#greetings').prop('scrollHeight'));    //ìŠ¤í¬ë¡¤ í¬ì»¤ìŠ¤

            // fetch ë°©ì‹ì´ ì•„ë‹Œ, jquery ë°©ì‹
            $.post(
                '/chat/write', // ì£¼ì†Œ, action
                {
                    chatMessage: form.message.value // í¼ ë‚´ìš©, input name, value
                },
                function(data) { // ì½œë°± ë©”ì„œë“œ, í†µì‹ ì´ ì™„ë£Œëœ í›„, ì‹¤í–‰

                    console.log("ë°›ì€ ë©”ì‹œì§€ : " + data.message);

                    // <div className="outgoing-box">
                    //     <div className="outgoing">
                    //         ì•ˆë…•í•˜ì„¸ìš”. ğŸ˜Š <br/>
                    //         Shadow ì±—ë´‡ ì…ë‹ˆë‹¤! <br/>
                    //         <br/>
                    //         â€» Shadow ì„œë¹„ìŠ¤ ì´ìš© ì•ˆë‚´ <br/>
                    //         ìì£¼ ì°¾ëŠ” ëª©ì ì§€ëŠ” ì±—ë´‡ í•˜ë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br/>
                    //         ì›í•˜ëŠ” ëª©ì ì§€ê°€ ì—†ë‹¤ë©´, ê¶ê¸ˆí•œ ì‚¬í•­ì„ ì±„íŒ…í•´ì£¼ì„¸ìš”.
                    //     </div>
                    //     <img th:src="@{/image/icon.png}" style="width: 35px; height: 35px; vertical-align: top"/>
                    // </div>

                    $("#greetings").append("<div class=\"outgoing-box\"><div class=\"outgoing\">" + data.message + "</div><img src=\"/image/icon.png\" style=\"width: 35px; height: 35px; vertical-align: top\"/></div>");    //html ì¶”ê°€
                    $('#greetings').scrollTop($('#greetings').prop('scrollHeight'));    //ìŠ¤í¬ë¡¤ í¬ì»¤ìŠ¤
                },
                'json' // ë°›ì€ ë°ì´í„°ë¥¼ json ìœ¼ë¡œ í•´ì„í•˜ê² ë‹¤.
            );

            form.message.value = '';
            form.message.focus();
        }
    </script>

</head>
<body>


<!--ì±—ë´‡ offìƒíƒœ ë§í’ì„ -->
<button type="button" class="ch-button" onclick="OpenChat()" id="btnChatOpen">
    <img th:src="@{/image/icon.png}" style="object-fit: cover; width: 100%" />
<!--<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">-->
<!--    <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>-->
<!--    <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>-->
<!--</svg>-->
</button>

<!--ì±„íŒ…ì°½-->
<div class="chat_container" id="container">
    <div class="chatbox">

<!--ì±—ë´‡ ìƒë‹¨-->
        <div class="top-bar">
            <!--ì•„ì´ì½˜-->
            <div class="icon-image">
                <img th:src="@{/image/icon_name.png}" style="object-fit: cover; width: 100%" />
            </div>
<!--            <div class="avatar"><div>S</div></div>-->
<!--            &lt;!&ndash;ì±„íŒ…ë°© ì œëª©&ndash;&gt;-->
<!--            <div class="name">SHADOW</div>-->
            <div class="gap"></div>
            <!-- ì±„íŒ…ì°½ ë‹«ê¸° -->
            <button type="button" class="btn-close" aria-label="Close" onclick="CloseChat()"></button>
        </div>

<!--ì±—ë´‡ ì¤‘ë‹¨-->
        <div class="middle" id="greetings">
                <div class="incoming">
                    hello
                </div>

                <div class="outgoing-box">
                    <div class="outgoing">
                        ì•ˆë…•í•˜ì„¸ìš”. ğŸ˜Š <br/>
                        Shadow ì±—ë´‡ ì…ë‹ˆë‹¤! <br/>
                        <br/>
                        â€» Shadow ì„œë¹„ìŠ¤ ì´ìš© ì•ˆë‚´ <br/>
                        ìì£¼ ì°¾ëŠ” ëª©ì ì§€ëŠ” ì±—ë´‡ í•˜ë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br/>
                        ì›í•˜ëŠ” ëª©ì ì§€ê°€ ì—†ë‹¤ë©´, ê¶ê¸ˆí•œ ì‚¬í•­ì„ ì±„íŒ…í•´ì£¼ì„¸ìš”.
                    </div>
                    <img th:src="@{/image/icon.png}" style="width: 35px; height: 35px; vertical-align: top" />
                </div>
        </div>

<!--ì±—ë´‡ í•˜ë‹¨-->
        <div class="bottom-bar">
            <div class="d-flex flex-row justify-content-evenly favorite-box">
                <a class="px-2 py-1 favorite" th:each="favoriteKeyword : ${favoriteKeywords}" th:href="@{${favoriteKeyword.value}}" th:text="${favoriteKeyword.key}"/>
            </div>
            <form class="send-form" onsubmit="ChatMessageWrite(event, this);">
                <div class="form-box">
                    <input class="input-msg" type="text" id="message" name="message" placeholder="Type a message..." />
                    <div class="gap"></div>
                    <button type="submit" id="send">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#58CCFF" class="bi bi-send" viewBox="0 0 16 16">
                            <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                        </svg></button>
                </div>
            </form>
        </div>

    </div>
</div>
</body>
</html>